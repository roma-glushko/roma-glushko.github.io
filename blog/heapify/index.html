<!DOCTYPE html><html lang="en" class="blogpost-view-page"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><link rel="stylesheet" href="/styles.d592d42a64a6c9e3b422.css"/><title data-react-helmet="true">Heapify ✌️ - Blog by Roman Glushko</title><meta data-react-helmet="true" name="image" property="og:image" content="https://www.romaglushko.com/static/20fe662fa316fc9e5d4b4c6eaeaf84f6/35aef/markus-spiske-IiEFmIXZWSw-unsplash-min.jpg"/><meta data-react-helmet="true" name="description" property="og:description" content="How the priority queue and heap work: theory, implementation, complexity. Heap sorting and other applications."/><meta data-react-helmet="true" name="keywords" content="algorithmic coding,data structures,python"/><meta data-react-helmet="true" name="author" content="@roma_glushko"/><meta data-react-helmet="true" property="og:title" content="Heapify ✌️ - Blog"/><meta data-react-helmet="true" property="og:type" content="article"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:creator" content="@roma_glushko"/><meta data-react-helmet="true" name="twitter:title" content="Heapify ✌️ - Blog"/><meta data-react-helmet="true" name="twitter:description" content="How the priority queue and heap work: theory, implementation, complexity. Heap sorting and other applications."/><meta data-react-helmet="true" property="og:url" content="https://www.romaglushko.com/blog/heapify/"/><script data-react-helmet="true" type="application/ld+json">{"@context":"http://schema.org","@type":"BlogPosting","image":"/static/20fe662fa316fc9e5d4b4c6eaeaf84f6/35aef/markus-spiske-IiEFmIXZWSw-unsplash-min.jpg","headline":"Heapify ✌️","dateCreated":"2021-05-16","datePublished":"2021-05-16","dateModified":"2021-05-16","inLanguage":"en-US","isFamilyFriendly":"true","author":{"@type":"Person","name":"Roman Glushko"},"publisher":{"@type":"Organization","name":"Roman Glushko's Website"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://www.romaglushko.com/blog/heapify/"},"keywords":["algorithmic coding","data structures","python"],"genre":["machine learning","software engineering","science","deep learning","statistics"],"articleSection":"Technical Blog","articleBody":"\nWhen you have a sequence of candidates to process, then you build a queue to organize them. In the classical queue, the time of adding an item to the queue defines when it's going to be processed.\n\nWhat if we need to change this principle and use some **relative importance score** to determine the item processing sequence?\n\nWell, then we would reinvent ~~bicycle~~ the priority queue.\n\n`video: title: \"Priority\": https://media.giphy.com/media/3orif1K6QR54NlWzLO/giphy.mp4`\n\n**The priority queue or heap** is a data structure that efficiently allows the retrieval of the next queued item with min or max importance score.\n\n## Nearly Complete Binary Tree\n\nThe heap can be represented as an array or a list that is visualized as a nearly complete binary tree:\n\n![Max Heap](./img/max-heap.png \"Max Heap\")\n<div class=\"image-title\">Max Heap</div>\n\nSince it's a binary tree, **all parent nodes** have **at max 2 children**. The binary tree is filled level by level from top to bottom, from left incomplete parent nodes (with none or one child) to right ones.\n\nWith such a node positioning, we can come up with formulas for finding parent/children nodes:\n\n- $element\\_idx / 2$ is the node parent index\n- $2 * element\\_idx$ is an index of the left child\n- $2 * element\\_idx + 1$ is an index of the right child\n\nwhere $element\\_idx$ is some node index.\n\nAdditionally, the binary tree has the following useful properties:\n\n- Heigh of the tree is $ln(N) + 1$\n\nThe \"nearly complete\" means that **not all tree levels** may be **filled out** by leaf nodes (nodes without children). In other words, we can have a heap with any number of items.\n\nThe heap has a distinct property that actually makes it helpful:\n\n- all children node values should be **less or equal** to the parent node value (**the max-heap property**)\n- or all children node values should be **greater or equal** to the parent node value (**the min-heap property**)\n\nTo explain how all of this can be useful, we are going to implement the main heap functions from scratch.\n## Heap Building\n\nThere is going to be a custom `PriorityQueue` class which takes an arbitrary array of integers, makes a heap from it and sustains the heap property during all operations.\n\nThe first thing we need to do is to build a max heap from an unsorted array. We can already visualize the array as a heap, but it would **luck the max heap property**.\n\nNotice that **leaf nodes can't violate the heap property** since they don't have any child nodes. Hence, we can start looking at possible violations from the second-to-last level. The index of the last parent element on that level we can get via `n // 2` where `n` is the size of the array.\n\nWe start moving from right to left, from the bottom to the top of the heap. For each parent node, we need to make sure that the property of the heap holds true. If there is any violations, we just switch the current parent node with a child node that is greater than it (which violates the heap property).\n\nHowever, this switching of the nodes may create a new violation on the levels below. So we need to perform the same procedure again for a node that became a child.\n\n`video: title: \"Building a heap\": ./img/heapify.mp4`\n<div class=\"image-title\">Max Heapifying</div>\n\nHere is how this can be implemented:\n\n```python\nfrom typing import List\n\n\nclass PriorityQueue:\n    \"\"\"\n    Represents the heap and preserves the heap property during adding/removing elements\n    \"\"\"\n    items: List[int]\n\n    def __init__(self, items: List[int]):\n        self.items = self.build_heap(items)\n\n    def build_heap(self, items: List[int]) -> List[int]:\n        \"\"\"\n        Turn an unsorted array into a heap\n        \"\"\"\n        items_count = len(items)\n\n        for i in range(items_count // 2, -1, -1):\n            items = self.heapify(items, i)\n\n        return items\n\n    def heapify(self, items: List[int], node_idx: int, root_idx: int = 0) -> List[int]:\n        \"\"\"\n        Check and fix violations of the heap property recursively\n        \"\"\"\n        items_count = len(items)\n        largest_idx = node_idx\n\n        # formulas for zero-indexed arrays\n        left_child_idx = 2 * (node_idx - root_idx) + 1 + root_idx\n        right_child_idx = 2 * (node_idx - root_idx) + 2 + root_idx\n\n        # is the left child node bigger than parent node?\n        if left_child_idx < items_count and items[left_child_idx] > items[largest_idx]:\n            largest_idx = left_child_idx\n\n        # is the right child node bigger than parent or left node?\n        if right_child_idx < items_count and items[right_child_idx] > items[largest_idx]:\n            largest_idx = right_child_idx\n\n        # let's fix a violation of the heap property\n        if largest_idx != node_idx:\n            items[node_idx], items[largest_idx] = items[largest_idx], items[node_idx]\n\n            return self.heapify(items, largest_idx, root_idx=root_idx)\n\n        return items\n\n    def size(self) -> int:\n        return len(self.items)\n```\n\nComplexity of this algorithm is $\\Theta(n)$. This is because we check each position only once making our way up the heap. All levels below the current one at each point of time are already satisfying the heap property. So there is no need to back them up.\n\n## Adding a New Element\n\nAnother useful method to have is adding a new item to the heap. In this case, it's convenient to add a new item as a leaf node in the end of the heap array. This makes sure there are no violations below it. However, there may be some going upward. That's why we need to go all the way up and check whenever parent nodes are greater than the new item. If they are not, we will switch their positions.\n\nSince the max heap property had stayed true before we add the new item, it's sufficient for us to check only parent nodes as we know that all child nodes should be less or equal to the parent value. \n\n`video: title: \"Insert a new item to the heap\": ./img/insert-a-new-item-to-the-heap.mp4`\n<div class=\"image-title\">Insert a new item to the heap</div>\n\nNow we can take a look at the implementation:\n\n```python\ndef push(self, item: int):\n    \"\"\"\n    Add a new item to the heap preserving the heap property\n    \"\"\"\n    self.items.append(item)\n\n    idx = len(self.items) - 1\n    parent_idx = idx // 2\n\n    if idx % 2 == 0:\n        # calculating parents in zero-indexed array\n        parent_idx -= 1\n\n    while idx > 0 and self.items[idx] > self.items[parent_idx]:\n        tmp = self.items[parent_idx]\n        self.items[parent_idx] = self.items[idx]\n        self.items[idx] = tmp\n\n        idx = parent_idx\n        parent_idx = idx // 2\n\n        if idx % 2 == 0:\n            # calculating parents in zero-indexed array\n            parent_idx -= 1\n```\n\nThe complexity of heap inserting algorithm is $\\Theta(log(n))$ since at each interaction we traversal another tree level.\n\n## Extracting The Max Element\n\nThe key method of the heap is extracting the max element. Because of the heap property, the max element should always stay that the top of the heap. So it's as simple as call `self.items[0]` to get it.\n\nThat's not all. The extraction would remove the element from the heap and we can not just leave it with a \"hole\". Instead, we need to put the next max element there.\n\nLike before, the safest way is to **replace the hole with the last leaf node** (not to change the heap property in other branches of the heap). The last item is just handy to use, but it's not necessarily the next needed candidate to be at the top of the heap. To make sure, we need to run the `heapify()` method which recursively fixes all violations.\n\n`video: title: \"Extract the max element from the heap\": ./img/extract-max-element-from-the-heap.mp4`\n<div class=\"image-title\">Extract the max element from the heap</div>\n\nThe implementation is straightforward:\n\n```python\ndef pop(self):\n    \"\"\"\n    Extract the next item from the heap according to priority (the next biggest element in our max heap case)\n    \"\"\"\n    item = self.items[0]\n\n    items_count = len(self.items)\n    self.items[0] = self.items[items_count - 1]  # replace extracted max element with one of the balanced leaves\n    del self.items[items_count - 1]\n\n    self.items = self.heapify(self.items, 0)\n\n    return item\n```\n\nThe complexity of heap items extracting algorithm is $\\Theta(log(n))$. Nevertheless, we can get access to the current max element in $\\Theta(1)$.\n\n## Heap Sort\n\nNow we have all components to implement one of the most frequent applications of the priority queue - the heap sorting.\n\nHeap sort is just the extraction of `n` elements from the heap.\n\n`video: title: \"Heap Sort In Action\": ./img/heap-sort.mp4`\n<div class=\"image-title\">Heap Sort In Action</div>\n\nThe simplest implementation of the heap source may look like this in Python:\n\n```python\ndef heap_sort(heap: PriorityQueue) -> List[int]:\n    items_count = heap.size()\n    \n    result = []\n\n    for i in range(items_count):\n        result.append(heap.pop())\n\n    return result\n```\n\nThe complexity of heap sorting is $\\Theta(nlog(n))$.\n\nIt takes the additional memory to store another sorted copy of the array. However, we can do in-place sorting as well:\n\n```python\ndef sort(self) -> List[int]:\n    \"\"\"\n    In-place version of the heap sort.\n    It breaks the heap property, so be aware of that.\n    \"\"\"\n    items_count = self.size()\n\n    for i in range(1, items_count - 1):\n        # find the next max element/restore the heap property\n        items = self.heapify(self.items, i, root_idx=i)\n\n    return self.items\n```\n\nIn this approach, we use the root node offset trick that helps us to change the position of the root node and move from the left to right sorting the `self.items` array. The `root_idx` param is just tweaks the child calculation formula for that.\n\nThe cost of being in-place solution is breaking the heap property in `self.items` array. I would prefer the first version of the heap sort in order to avoid such a mutations to `self.items` array.\n\n## Applications\n\nHeap sorting is not the only application of the priority queue. Here are a few more cases where heaps are being applied:\n\n- access to a limited resource like making sure your Zoom application has a high network bandwidth priority, hence, lower latency\n- device interruption handling like pressing a key on the keyboard triggers a specific interruption handler that rads a key value and send it to the OS. There is an interruption latency associated with this process and interruptions from some devices we wish to be processed as soon as possible\n- the heap can be used during searching for <a target=\"_blank\" rel=\"noopener\" href=\"/blog/k-nearest-neighbors/\">K-Nearest Neighbors</a>\n\nBroadly speaking, the heap may be used everywhere where we need to keep track of the list of min or max elements that may be changed during the runtime.\n\n## heapq\n\nThankfully, it's not required to implement the heap yourself everytime you need it. Python provides a library called <a target=\"_blank\" rel=\"noopener\" href=\"https://docs.python.org/3/library/heapq.html\">heapq</a> which is a set of functions that operates on the \"heapified\" array preserving the min-heap property.\n\nThe min-heap sort can be implemented this way:\n\n```python\nimport heapq\n\nheap = [2, 7, 26, 25, 19, 17, 1, 90, 3, 36]\nheapq.heapify(heap)\n\nresult = []\nn = len(heap)\n\nfor i in range(n):\n    result.append(heapq.heappop(heap))\n```\n\n## Practice\n\n- <a target=\"_blank\" rel=\"noopener\" href=\"https://leetcode.com/problems/last-stone-weight/\">[Leetcode] 1046. Last Stone Weight</a>\n- <a target=\"_blank\" rel=\"noopener\" href=\"https://leetcode.com/problems/single-threaded-cpu/\">[Leetcode] 1834. Single-Threaded CPU</a>\n- <a target=\"_blank\" rel=\"noopener\" href=\"https://leetcode.com/problems/find-k-th-smallest-pair-distance/\">[Leetcode] 719. Find K-th Smallest Pair Distance</a>\n\n## Summary\n\nIn this article, we have reviewed how to implement a priority queue, what properties it has and how it can be helpful.\n\nIf the heap concept was new for you, try to do a few problems from the practice section.\n\nFinally, let me know in the comments what unusual applications of heaps you have seen in your practice.\n\n## References\n\n- <a target=\"_blank\" rel=\"noopener\" href=\"https://gist.github.com/roma-glushko/43678fcec904209adb276f33a56ce9de\">Source code on GitHub</a>\n- <a target=\"_blank\" rel=\"noopener\" href=\"https://ocw.mit.edu/courses/electrical-engineering-and-computer-science/6-006-introduction-to-algorithms-fall-2011/lecture-videos/lecture-4-heaps-and-heap-sort/\">MIT 6.006 - Heaps and Heap Sort</a>\n- <a target=\"_blank\" rel=\"noopener\" href=\"https://visualgo.net/en/heap\">Heap Visualized</a>\n","wordcount":1307}</script><script data-react-helmet="true" type="application/ld+json">{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Home","item":"https://www.romaglushko.com/"},{"@type":"ListItem","position":2,"name":"Blog","item":"https://www.romaglushko.com/blog/"},{"@type":"ListItem","position":3,"name":"Heapify ✌️","item":"https://www.romaglushko.com/blog/heapify/"}]}</script><script data-react-helmet="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" defer="" async=""></script><link crossorigin="" href="https://utteranc.es" rel="preconnect"/><link crossorigin="" href="https://www.google-analytics.com" rel="preconnect"/><link rel="icon" href="/favicon-32x32.png?v=58a31253e5b93c1d7e74e8a017ff47b3"/><link rel="manifest" href="/manifest.webmanifest"/><meta name="theme-color" content="#ffffff"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=58a31253e5b93c1d7e74e8a017ff47b3"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=58a31253e5b93c1d7e74e8a017ff47b3"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=58a31253e5b93c1d7e74e8a017ff47b3"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=58a31253e5b93c1d7e74e8a017ff47b3"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=58a31253e5b93c1d7e74e8a017ff47b3"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=58a31253e5b93c1d7e74e8a017ff47b3"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=58a31253e5b93c1d7e74e8a017ff47b3"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=58a31253e5b93c1d7e74e8a017ff47b3"/><link rel="preload" as="font" type="font/woff2" crossorigin="anonymous" href="/static/webfonts/s/dancingscript/v19/If2cXTr6YS-zF4S-kcSWSVi_sxjsohD9F50Ruu7BMSo3Sup8.woff2"/><link rel="preload" as="font" type="font/woff2" crossorigin="anonymous" href="/static/webfonts/s/dancingscript/v19/If2cXTr6YS-zF4S-kcSWSVi_sxjsohD9F50Ruu7B1i03Sup8.woff2"/><link rel="preload" as="font" type="font/woff2" crossorigin="anonymous" href="/static/webfonts/s/ledger/v11/j8_q6-HK1L3if_sBnMrx.woff2"/><style>@font-face{font-family:Dancing Script;font-style:normal;font-weight:400;font-display:swap;src:url(/static/webfonts/s/dancingscript/v19/If2cXTr6YS-zF4S-kcSWSVi_sxjsohD9F50Ruu7BMSo3Sup8.woff2) format("woff2")}@font-face{font-family:Dancing Script;font-style:normal;font-weight:700;font-display:swap;src:url(/static/webfonts/s/dancingscript/v19/If2cXTr6YS-zF4S-kcSWSVi_sxjsohD9F50Ruu7B1i03Sup8.woff2) format("woff2")}@font-face{font-family:Dancing Script;font-style:normal;font-weight:400;font-display:swap;src:url(/static/webfonts/s/dancingscript/v19/If2cXTr6YS-zF4S-kcSWSVi_sxjsohD9F50Ruu7BMSo3Sup6.woff) format("woff")}@font-face{font-family:Dancing Script;font-style:normal;font-weight:700;font-display:swap;src:url(/static/webfonts/s/dancingscript/v19/If2cXTr6YS-zF4S-kcSWSVi_sxjsohD9F50Ruu7B1i03Sup6.woff) format("woff")}@font-face{font-family:Ledger;font-style:normal;font-weight:400;font-display:swap;src:url(/static/webfonts/s/ledger/v11/j8_q6-HK1L3if_sBnMrx.woff2) format("woff2")}@font-face{font-family:Ledger;font-style:normal;font-weight:400;font-display:swap;src:url(/static/webfonts/s/ledger/v11/j8_q6-HK1L3if_sBnMr3.woff) format("woff")}</style><link rel="preconnect dns-prefetch" href="https://www.google-analytics.com"/><link rel="stylesheet"/><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop
          var clientTop = document.documentElement.clientTop || document.body.clientTop || 0
          var offset = element.getBoundingClientRect().top + scrollTop - clientTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script><link rel="canonical" href="https://www.romaglushko.com/blog/heapify/" data-baseprotocol="https:" data-basehost="www.romaglushko.com"/><link rel="sitemap" type="application/xml" href="/sitemap.xml"/><link as="script" rel="preload" href="/webpack-runtime-22fa0e136c234d8b60a6.js"/><link as="script" rel="preload" href="/framework-68e90182ffbbad46751e.js"/><link as="script" rel="preload" href="/app-de8843e408d337e1ffde.js"/><link as="script" rel="preload" href="/styles-8636a280cbc61d53ad10.js"/><link as="script" rel="preload" href="/02e3c991cb460df38a850baf561b952fff7f05a7-120d26a5ba92bd694f64.js"/><link as="script" rel="preload" href="/7fec078d47fb9647f833e2e6379c6e0182872dcf-593e4006fd0d611c716c.js"/><link as="script" rel="preload" href="/b1d143cac6741dab3b540359698892a994dd2b72-73811f87155839f25d7a.js"/><link as="script" rel="preload" href="/418ffc66a997cc995fb5d56035c003ac177781e9-1af6fa4b36bef9e9a491.js"/><link as="script" rel="preload" href="/4622c33586ad0108e870f951288ae6aa3beabfab-9d3664eaca38d9dab227.js"/><link as="script" rel="preload" href="/component---src-templates-blog-template-js-95e00e24c0c08926f00c.js"/><link as="fetch" rel="preload" href="/page-data/blog/heapify/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><script>
void function() {
  window.__onThemeChange = function() {}

  var preferredTheme
  try {
    preferredTheme = localStorage.getItem('theme')
  } catch (err) { }

  function setTheme(newTheme) {
    if (preferredTheme && document.body.classList.contains(preferredTheme)) {
      document.body.classList.replace(preferredTheme, newTheme)
    } else {
      document.body.classList.add(newTheme)
    }

    window.__theme = newTheme
    preferredTheme = newTheme
    window.__onThemeChange(newTheme)
  }

  window.__setPreferredTheme = function(newTheme) {
    setTheme(newTheme)
    try {
      localStorage.setItem('theme', newTheme)
    } catch (err) {}
  }

  var darkQuery = window.matchMedia('(prefers-color-scheme: dark)')
  darkQuery.addListener(function(e) {
    window.__setPreferredTheme(e.matches ? 'dark' : 'light')
  })

  setTheme(preferredTheme || (darkQuery.matches ? 'dark' : 'light'))
}()
    </script><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div><div class="blogpost-header"><div class="view-page-header"><div class="view-page-header-wrapper"><div class="logo-wrapper"><div class="logo"><div class="logo-img gatsby-image-wrapper" style="position:relative;overflow:hidden"><div aria-hidden="true" style="width:100%;padding-bottom:100%"></div><img aria-hidden="true" src="data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAUABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAEEBf/EABYBAQEBAAAAAAAAAAAAAAAAAAIBBP/aAAwDAQACEAMQAAABtmSLU1KeLAa+iHm//8QAHBABAAICAwEAAAAAAAAAAAAAAQACAxIEISNB/9oACAEBAAEFAkuCLNbTNl1lczWHZd9vnHfL/8QAGBEAAwEBAAAAAAAAAAAAAAAAAAECMRD/2gAIAQMBAT8BS5OFaf/EABYRAAMAAAAAAAAAAAAAAAAAAAABEP/aAAgBAgEBPwGo/8QAGRAAAgMBAAAAAAAAAAAAAAAAAAEQESES/9oACAEBAAY/ArMuOU9NLQxx/8QAHBABAAICAwEAAAAAAAAAAAAAAQARIVExYXGR/9oACAEBAAE/IXCVlFftHewg5k+Rq7IcxhphiNu2Lii09n//2gAMAwEAAgADAAAAEKAPfP/EABoRAAICAwAAAAAAAAAAAAAAAAABETEhQfD/2gAIAQMBAT8Qa0OVgt7Ref/EABcRAQEBAQAAAAAAAAAAAAAAAAAxARH/2gAIAQIBAT8Q2uNqH//EAB4QAQACAgEFAAAAAAAAAAAAAAEAESExUUFhcYGh/9oACAEBAAE/EKIFxuEXF2cBIp2+ZREzlLBC1DYAUnrr3irELKYzK1D7GCYEbhQw0tz/2Q==" alt="" style="position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover;object-position:center;opacity:1;transition-delay:500ms"/><noscript><picture><source srcset="/static/7d8b62b999b9a2fb28b8ab360138da37/b13df/photo3.jpg 40w,
/static/7d8b62b999b9a2fb28b8ab360138da37/4e333/photo3.jpg 80w,
/static/7d8b62b999b9a2fb28b8ab360138da37/e75b5/photo3.jpg 160w,
/static/7d8b62b999b9a2fb28b8ab360138da37/40426/photo3.jpg 240w,
/static/7d8b62b999b9a2fb28b8ab360138da37/c01e2/photo3.jpg 320w,
/static/7d8b62b999b9a2fb28b8ab360138da37/b1563/photo3.jpg 3677w" sizes="(max-width: 160px) 100vw, 160px" /><img loading="lazy" sizes="(max-width: 160px) 100vw, 160px" srcset="/static/7d8b62b999b9a2fb28b8ab360138da37/b13df/photo3.jpg 40w,
/static/7d8b62b999b9a2fb28b8ab360138da37/4e333/photo3.jpg 80w,
/static/7d8b62b999b9a2fb28b8ab360138da37/e75b5/photo3.jpg 160w,
/static/7d8b62b999b9a2fb28b8ab360138da37/40426/photo3.jpg 240w,
/static/7d8b62b999b9a2fb28b8ab360138da37/c01e2/photo3.jpg 320w,
/static/7d8b62b999b9a2fb28b8ab360138da37/b1563/photo3.jpg 3677w" src="/static/7d8b62b999b9a2fb28b8ab360138da37/e75b5/photo3.jpg" alt="" style="position:absolute;top:0;left:0;opacity:1;width:100%;height:100%;object-fit:cover;object-position:center"/></picture></noscript></div></div><div class="name"><a href="/blog/" title="back to blog">Roman <br/> Glushko</a></div></div><h2 class="blog-title"><a href="/blog/" title="back to the homepage">Blog</a></h2></div></div><nav class="main-navigation"><ul><li><a rel="home" title="Go Home" href="/">Home</a></li><li><a title="Go to my Technical Blog" href="/blog/">Blog</a></li><li><a title="Go to my Lab" href="/lab/">Lab</a></li><li><a title="Go to my Thoughts" href="/thoughts/">Thoughts</a></li><li><a title="Review My CVs" href="/cv/machine-learning-engineer/">CV</a></li></ul></nav></div><main><article class="blog-wrapper"><header><figure class="cover"><div class="cover-filter"><div class="cover cover-image gatsby-image-wrapper" style="position:relative;overflow:hidden"><div aria-hidden="true" style="width:100%;padding-bottom:66.70588235294117%"></div><img aria-hidden="true" src="data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAQFAQb/xAAVAQEBAAAAAAAAAAAAAAAAAAABAP/aAAwDAQACEAMQAAABWyyqUI6QT//EABsQAAICAwEAAAAAAAAAAAAAAAECAxEAEyEy/9oACAEBAAEFAtMlLE2MCpHmY07N3//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABURAQEAAAAAAAAAAAAAAAAAABAR/9oACAECAQE/AYf/xAAbEAABBAMAAAAAAAAAAAAAAAABAAIQESNBYf/aAAgBAQAGPwIUwrIw8VGG7j//xAAaEAADAQEBAQAAAAAAAAAAAAAAAREhMUFh/9oACAEBAAE/IXQqRU9DyifGmcHSIaw/fpDhM//aAAwDAQACAAMAAAAQcx//xAAXEQADAQAAAAAAAAAAAAAAAAABEBEh/9oACAEDAQE/ELTq/8QAFxEBAAMAAAAAAAAAAAAAAAAAARARIf/aAAgBAgEBPxAoZH//xAAcEAEAAgMAAwAAAAAAAAAAAAABABEhMUFRkaH/2gAIAQEAAT8QHSujrXuY4hWxBe48RydcSo0Isi7jgCIFV8VqNS1jaXP/2Q==" alt="" style="position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover;object-position:center;opacity:1;transition-delay:500ms"/><noscript><picture><source srcset="/static/20fe662fa316fc9e5d4b4c6eaeaf84f6/809fc/markus-spiske-IiEFmIXZWSw-unsplash-min.jpg 850w,
/static/20fe662fa316fc9e5d4b4c6eaeaf84f6/4f4f6/markus-spiske-IiEFmIXZWSw-unsplash-min.jpg 1700w,
/static/20fe662fa316fc9e5d4b4c6eaeaf84f6/35aef/markus-spiske-IiEFmIXZWSw-unsplash-min.jpg 3400w,
/static/20fe662fa316fc9e5d4b4c6eaeaf84f6/9a201/markus-spiske-IiEFmIXZWSw-unsplash-min.jpg 5100w,
/static/20fe662fa316fc9e5d4b4c6eaeaf84f6/c128d/markus-spiske-IiEFmIXZWSw-unsplash-min.jpg 5760w" sizes="(max-width: 3400px) 100vw, 3400px" /><img loading="lazy" sizes="(max-width: 3400px) 100vw, 3400px" srcset="/static/20fe662fa316fc9e5d4b4c6eaeaf84f6/809fc/markus-spiske-IiEFmIXZWSw-unsplash-min.jpg 850w,
/static/20fe662fa316fc9e5d4b4c6eaeaf84f6/4f4f6/markus-spiske-IiEFmIXZWSw-unsplash-min.jpg 1700w,
/static/20fe662fa316fc9e5d4b4c6eaeaf84f6/35aef/markus-spiske-IiEFmIXZWSw-unsplash-min.jpg 3400w,
/static/20fe662fa316fc9e5d4b4c6eaeaf84f6/9a201/markus-spiske-IiEFmIXZWSw-unsplash-min.jpg 5100w,
/static/20fe662fa316fc9e5d4b4c6eaeaf84f6/c128d/markus-spiske-IiEFmIXZWSw-unsplash-min.jpg 5760w" src="/static/20fe662fa316fc9e5d4b4c6eaeaf84f6/35aef/markus-spiske-IiEFmIXZWSw-unsplash-min.jpg" alt="" style="position:absolute;top:0;left:0;opacity:1;width:100%;height:100%;object-fit:cover;object-position:center"/></picture></noscript></div></div><figcaption class="image-title">Photo by <a href="https://unsplash.com/@markusspiske">Markus Spiske</a> on <a href="https://unsplash.com/">Unsplash</a></figcaption></figure><h1>Heapify ✌️</h1><div class="blog-details"><time class="blog-createdat" dateTime="2021-05-16">May 16, 2021</time><span> • </span><span class="blog-time2read">9<!-- --> min read</span><div class="theme-switcher"><div class="theme-switcher-toggler"><div class="theme-switcher-track"></div><div class="theme-switcher-thumb"></div><input type="checkbox" class="theme-switcher-input" readonly="" aria-label="Switch between Dark and Light mode"/></div></div></div><ul class="blog-tags"><li>algorithmic coding</li><li>data structures</li><li>python</li></ul></header><div id="intro" class="blog-divider"></div><div class="content-wrapper"><div class="blog-content-nav-wrapper"><ul class="blog-content-nav"><h2>Content</h2><li class=""><a href="#intro">Intro</a></li></ul></div><div class="content blog-content"><p>When you have a sequence of candidates to process, then you build a queue to organize them. In the classical queue, the time of adding an item to the queue defines when it's going to be processed.</p>
<p>What if we need to change this principle and use some <strong>relative importance score</strong> to determine the item processing sequence?</p>
<p>Well, then we would reinvent <del>bicycle</del> the priority queue.</p>
<p>
		<video
			src=https://media.giphy.com/media/3orif1K6QR54NlWzLO/giphy.mp4
			width="100%"
			height="auto"
			preload="auto"
			muted="true"
			title="Priority"
			autoplay
			playsinline
			controls
			loop
		></video>
	</p>
<p><strong>The priority queue or heap</strong> is a data structure that efficiently allows the retrieval of the next queued item with min or max importance score.</p>
<h2 id="nearly-complete-binary-tree" style="position:relative;"><a href="#nearly-complete-binary-tree" aria-label="nearly complete binary tree permalink" class="anchor before"><svg class="anchor-icon" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Nearly Complete Binary Tree</h2>
<p>The heap can be represented as an array or a list that is visualized as a nearly complete binary tree:</p>
<p><span class="gatsby-resp-image-wrapper" style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; ">
      <span class="gatsby-resp-image-background-image" style="padding-bottom: 28.82352941176471%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAIAAABM9SnKAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAvElEQVQY041PfwuCMBTc9/9kQoRJYggmzlYS2mQbtrlf9txAMAi6P8bxbu/uHlp+Q0o5DIO19mvuvY8EbSPn3ItSrbUI4Jw/uy7PMiCMMXiVlNM0Ad9WENhwISCEUno6HFqMQQa+BkJCCHkHte/7S56XRRHdpVKIjuMxSQghap7hqzYGY3xO01gvNhSMwZp1Dup5cHXu1jT3tkXXsgQZ1zXBGEhTVY9AtsNWQAtjdncHI7RovZOVWqDCf/gATA1af16+IZEAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;"></span>
  <img class="gatsby-resp-image-image" alt="Max Heap" title="Max Heap" src="/static/be0a11ae707f1a5968ed6d7e4217e3bf/c5bb3/max-heap.png" srcset="/static/be0a11ae707f1a5968ed6d7e4217e3bf/04472/max-heap.png 170w,
/static/be0a11ae707f1a5968ed6d7e4217e3bf/9f933/max-heap.png 340w,
/static/be0a11ae707f1a5968ed6d7e4217e3bf/c5bb3/max-heap.png 680w,
/static/be0a11ae707f1a5968ed6d7e4217e3bf/b12f7/max-heap.png 1020w,
/static/be0a11ae707f1a5968ed6d7e4217e3bf/b5a09/max-heap.png 1360w,
/static/be0a11ae707f1a5968ed6d7e4217e3bf/61583/max-heap.png 1616w" sizes="(max-width: 680px) 100vw, 680px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;" loading="lazy">
    </span>
          </p>
<div class="image-title">Max Heap</div>
<p>Since it's a binary tree, <strong>all parent nodes</strong> have <strong>at max 2 children</strong>. The binary tree is filled level by level from top to bottom, from left incomplete parent nodes (with none or one child) to right ones.</p>
<p>With such a node positioning, we can come up with formulas for finding parent/children nodes:</p>
<ul>
<li>$element\_idx / 2$ is the node parent index</li>
<li>$2 * element\_idx$ is an index of the left child</li>
<li>$2 * element\_idx + 1$ is an index of the right child</li>
</ul>
<p>where $element\_idx$ is some node index.</p>
<p>Additionally, the binary tree has the following useful properties:</p>
<ul>
<li>Heigh of the tree is $ln(N) + 1$</li>
</ul>
<p>The "nearly complete" means that <strong>not all tree levels</strong> may be <strong>filled out</strong> by leaf nodes (nodes without children). In other words, we can have a heap with any number of items.</p>
<p>The heap has a distinct property that actually makes it helpful:</p>
<ul>
<li>all children node values should be <strong>less or equal</strong> to the parent node value (<strong>the max-heap property</strong>)</li>
<li>or all children node values should be <strong>greater or equal</strong> to the parent node value (<strong>the min-heap property</strong>)</li>
</ul>
<p>To explain how all of this can be useful, we are going to implement the main heap functions from scratch.</p>
<h2 id="heap-building" style="position:relative;"><a href="#heap-building" aria-label="heap building permalink" class="anchor before"><svg class="anchor-icon" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Heap Building</h2>
<p>There is going to be a custom <code class="language-text">PriorityQueue</code> class which takes an arbitrary array of integers, makes a heap from it and sustains the heap property during all operations.</p>
<p>The first thing we need to do is to build a max heap from an unsorted array. We can already visualize the array as a heap, but it would <strong>luck the max heap property</strong>.</p>
<p>Notice that <strong>leaf nodes can't violate the heap property</strong> since they don't have any child nodes. Hence, we can start looking at possible violations from the second-to-last level. The index of the last parent element on that level we can get via <code class="language-text">n // 2</code> where <code class="language-text">n</code> is the size of the array.</p>
<p>We start moving from right to left, from the bottom to the top of the heap. For each parent node, we need to make sure that the property of the heap holds true. If there is any violations, we just switch the current parent node with a child node that is greater than it (which violates the heap property).</p>
<p>However, this switching of the nodes may create a new violation on the levels below. So we need to perform the same procedure again for a node that became a child.</p>
<p>
		<video
			src=/57048b8030e0ab8ba4571d2ab2920604/heapify.mp4
			width="100%"
			height="auto"
			preload="auto"
			muted="true"
			title="Building a heap"
			autoplay
			playsinline
			controls
			loop
		></video>
	</p>
<div class="image-title">Max Heapifying</div>
<p>Here is how this can be implemented:</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token keyword">from</span> typing <span class="token keyword">import</span> List


<span class="token keyword">class</span> <span class="token class-name">PriorityQueue</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    Represents the heap and preserves the heap property during adding/removing elements
    """</span>
    items<span class="token punctuation">:</span> List<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> items<span class="token punctuation">:</span> List<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>items <span class="token operator">=</span> self<span class="token punctuation">.</span>build_heap<span class="token punctuation">(</span>items<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">build_heap</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> items<span class="token punctuation">:</span> List<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> List<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""
        Turn an unsorted array into a heap
        """</span>
        items_count <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>items<span class="token punctuation">)</span>

        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>items_count <span class="token operator">//</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            items <span class="token operator">=</span> self<span class="token punctuation">.</span>heapify<span class="token punctuation">(</span>items<span class="token punctuation">,</span> i<span class="token punctuation">)</span>

        <span class="token keyword">return</span> items

    <span class="token keyword">def</span> <span class="token function">heapify</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> items<span class="token punctuation">:</span> List<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span><span class="token punctuation">,</span> node_idx<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">,</span> root_idx<span class="token punctuation">:</span> <span class="token builtin">int</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> List<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""
        Check and fix violations of the heap property recursively
        """</span>
        items_count <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>items<span class="token punctuation">)</span>
        largest_idx <span class="token operator">=</span> node_idx

        <span class="token comment"># formulas for zero-indexed arrays</span>
        left_child_idx <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">*</span> <span class="token punctuation">(</span>node_idx <span class="token operator">-</span> root_idx<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">+</span> root_idx
        right_child_idx <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">*</span> <span class="token punctuation">(</span>node_idx <span class="token operator">-</span> root_idx<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">2</span> <span class="token operator">+</span> root_idx

        <span class="token comment"># is the left child node bigger than parent node?</span>
        <span class="token keyword">if</span> left_child_idx <span class="token operator">&lt;</span> items_count <span class="token keyword">and</span> items<span class="token punctuation">[</span>left_child_idx<span class="token punctuation">]</span> <span class="token operator">></span> items<span class="token punctuation">[</span>largest_idx<span class="token punctuation">]</span><span class="token punctuation">:</span>
            largest_idx <span class="token operator">=</span> left_child_idx

        <span class="token comment"># is the right child node bigger than parent or left node?</span>
        <span class="token keyword">if</span> right_child_idx <span class="token operator">&lt;</span> items_count <span class="token keyword">and</span> items<span class="token punctuation">[</span>right_child_idx<span class="token punctuation">]</span> <span class="token operator">></span> items<span class="token punctuation">[</span>largest_idx<span class="token punctuation">]</span><span class="token punctuation">:</span>
            largest_idx <span class="token operator">=</span> right_child_idx

        <span class="token comment"># let's fix a violation of the heap property</span>
        <span class="token keyword">if</span> largest_idx <span class="token operator">!=</span> node_idx<span class="token punctuation">:</span>
            items<span class="token punctuation">[</span>node_idx<span class="token punctuation">]</span><span class="token punctuation">,</span> items<span class="token punctuation">[</span>largest_idx<span class="token punctuation">]</span> <span class="token operator">=</span> items<span class="token punctuation">[</span>largest_idx<span class="token punctuation">]</span><span class="token punctuation">,</span> items<span class="token punctuation">[</span>node_idx<span class="token punctuation">]</span>

            <span class="token keyword">return</span> self<span class="token punctuation">.</span>heapify<span class="token punctuation">(</span>items<span class="token punctuation">,</span> largest_idx<span class="token punctuation">,</span> root_idx<span class="token operator">=</span>root_idx<span class="token punctuation">)</span>

        <span class="token keyword">return</span> items

    <span class="token keyword">def</span> <span class="token function">size</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">int</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>items<span class="token punctuation">)</span></code></pre></div>
<p>Complexity of this algorithm is $\Theta(n)$. This is because we check each position only once making our way up the heap. All levels below the current one at each point of time are already satisfying the heap property. So there is no need to back them up.</p>
<h2 id="adding-a-new-element" style="position:relative;"><a href="#adding-a-new-element" aria-label="adding a new element permalink" class="anchor before"><svg class="anchor-icon" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Adding a New Element</h2>
<p>Another useful method to have is adding a new item to the heap. In this case, it's convenient to add a new item as a leaf node in the end of the heap array. This makes sure there are no violations below it. However, there may be some going upward. That's why we need to go all the way up and check whenever parent nodes are greater than the new item. If they are not, we will switch their positions.</p>
<p>Since the max heap property had stayed true before we add the new item, it's sufficient for us to check only parent nodes as we know that all child nodes should be less or equal to the parent value. </p>
<p>
		<video
			src=/504273255cec707881a6d5ccbc3f91a9/insert-a-new-item-to-the-heap.mp4
			width="100%"
			height="auto"
			preload="auto"
			muted="true"
			title="Insert a new item to the heap"
			autoplay
			playsinline
			controls
			loop
		></video>
	</p>
<div class="image-title">Insert a new item to the heap</div>
<p>Now we can take a look at the implementation:</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">push</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> item<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    Add a new item to the heap preserving the heap property
    """</span>
    self<span class="token punctuation">.</span>items<span class="token punctuation">.</span>append<span class="token punctuation">(</span>item<span class="token punctuation">)</span>

    idx <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>items<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span>
    parent_idx <span class="token operator">=</span> idx <span class="token operator">//</span> <span class="token number">2</span>

    <span class="token keyword">if</span> idx <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
        <span class="token comment"># calculating parents in zero-indexed array</span>
        parent_idx <span class="token operator">-=</span> <span class="token number">1</span>

    <span class="token keyword">while</span> idx <span class="token operator">></span> <span class="token number">0</span> <span class="token keyword">and</span> self<span class="token punctuation">.</span>items<span class="token punctuation">[</span>idx<span class="token punctuation">]</span> <span class="token operator">></span> self<span class="token punctuation">.</span>items<span class="token punctuation">[</span>parent_idx<span class="token punctuation">]</span><span class="token punctuation">:</span>
        tmp <span class="token operator">=</span> self<span class="token punctuation">.</span>items<span class="token punctuation">[</span>parent_idx<span class="token punctuation">]</span>
        self<span class="token punctuation">.</span>items<span class="token punctuation">[</span>parent_idx<span class="token punctuation">]</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>items<span class="token punctuation">[</span>idx<span class="token punctuation">]</span>
        self<span class="token punctuation">.</span>items<span class="token punctuation">[</span>idx<span class="token punctuation">]</span> <span class="token operator">=</span> tmp

        idx <span class="token operator">=</span> parent_idx
        parent_idx <span class="token operator">=</span> idx <span class="token operator">//</span> <span class="token number">2</span>

        <span class="token keyword">if</span> idx <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
            <span class="token comment"># calculating parents in zero-indexed array</span>
            parent_idx <span class="token operator">-=</span> <span class="token number">1</span></code></pre></div>
<p>The complexity of heap inserting algorithm is $\Theta(log(n))$ since at each interaction we traversal another tree level.</p>
<h2 id="extracting-the-max-element" style="position:relative;"><a href="#extracting-the-max-element" aria-label="extracting the max element permalink" class="anchor before"><svg class="anchor-icon" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Extracting The Max Element</h2>
<p>The key method of the heap is extracting the max element. Because of the heap property, the max element should always stay that the top of the heap. So it's as simple as call <code class="language-text">self.items[0]</code> to get it.</p>
<p>That's not all. The extraction would remove the element from the heap and we can not just leave it with a "hole". Instead, we need to put the next max element there.</p>
<p>Like before, the safest way is to <strong>replace the hole with the last leaf node</strong> (not to change the heap property in other branches of the heap). The last item is just handy to use, but it's not necessarily the next needed candidate to be at the top of the heap. To make sure, we need to run the <code class="language-text">heapify()</code> method which recursively fixes all violations.</p>
<p>
		<video
			src=/ac4d4e7e997ecd484aade4d0f2c10cb1/extract-max-element-from-the-heap.mp4
			width="100%"
			height="auto"
			preload="auto"
			muted="true"
			title="Extract the max element from the heap"
			autoplay
			playsinline
			controls
			loop
		></video>
	</p>
<div class="image-title">Extract the max element from the heap</div>
<p>The implementation is straightforward:</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">pop</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    Extract the next item from the heap according to priority (the next biggest element in our max heap case)
    """</span>
    item <span class="token operator">=</span> self<span class="token punctuation">.</span>items<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>

    items_count <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>items<span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>items<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>items<span class="token punctuation">[</span>items_count <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span>  <span class="token comment"># replace extracted max element with one of the balanced leaves</span>
    <span class="token keyword">del</span> self<span class="token punctuation">.</span>items<span class="token punctuation">[</span>items_count <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span>

    self<span class="token punctuation">.</span>items <span class="token operator">=</span> self<span class="token punctuation">.</span>heapify<span class="token punctuation">(</span>self<span class="token punctuation">.</span>items<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> item</code></pre></div>
<p>The complexity of heap items extracting algorithm is $\Theta(log(n))$. Nevertheless, we can get access to the current max element in $\Theta(1)$.</p>
<h2 id="heap-sort" style="position:relative;"><a href="#heap-sort" aria-label="heap sort permalink" class="anchor before"><svg class="anchor-icon" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Heap Sort</h2>
<p>Now we have all components to implement one of the most frequent applications of the priority queue - the heap sorting.</p>
<p>Heap sort is just the extraction of <code class="language-text">n</code> elements from the heap.</p>
<p>
		<video
			src=/c73facee0c9e850b4562b7b8c5b5cab8/heap-sort.mp4
			width="100%"
			height="auto"
			preload="auto"
			muted="true"
			title="Heap Sort In Action"
			autoplay
			playsinline
			controls
			loop
		></video>
	</p>
<div class="image-title">Heap Sort In Action</div>
<p>The simplest implementation of the heap source may look like this in Python:</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">heap_sort</span><span class="token punctuation">(</span>heap<span class="token punctuation">:</span> PriorityQueue<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> List<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
    items_count <span class="token operator">=</span> heap<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    result <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>items_count<span class="token punctuation">)</span><span class="token punctuation">:</span>
        result<span class="token punctuation">.</span>append<span class="token punctuation">(</span>heap<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> result</code></pre></div>
<p>The complexity of heap sorting is $\Theta(nlog(n))$.</p>
<p>It takes the additional memory to store another sorted copy of the array. However, we can do in-place sorting as well:</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">sort</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> List<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    In-place version of the heap sort.
    It breaks the heap property, so be aware of that.
    """</span>
    items_count <span class="token operator">=</span> self<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> items_count <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># find the next max element/restore the heap property</span>
        items <span class="token operator">=</span> self<span class="token punctuation">.</span>heapify<span class="token punctuation">(</span>self<span class="token punctuation">.</span>items<span class="token punctuation">,</span> i<span class="token punctuation">,</span> root_idx<span class="token operator">=</span>i<span class="token punctuation">)</span>

    <span class="token keyword">return</span> self<span class="token punctuation">.</span>items</code></pre></div>
<p>In this approach, we use the root node offset trick that helps us to change the position of the root node and move from the left to right sorting the <code class="language-text">self.items</code> array. The <code class="language-text">root_idx</code> param is just tweaks the child calculation formula for that.</p>
<p>The cost of being in-place solution is breaking the heap property in <code class="language-text">self.items</code> array. I would prefer the first version of the heap sort in order to avoid such a mutations to <code class="language-text">self.items</code> array.</p>
<h2 id="applications" style="position:relative;"><a href="#applications" aria-label="applications permalink" class="anchor before"><svg class="anchor-icon" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Applications</h2>
<p>Heap sorting is not the only application of the priority queue. Here are a few more cases where heaps are being applied:</p>
<ul>
<li>access to a limited resource like making sure your Zoom application has a high network bandwidth priority, hence, lower latency</li>
<li>device interruption handling like pressing a key on the keyboard triggers a specific interruption handler that rads a key value and send it to the OS. There is an interruption latency associated with this process and interruptions from some devices we wish to be processed as soon as possible</li>
<li>the heap can be used during searching for <a target="_blank" rel="noopener" href="/blog/k-nearest-neighbors/">K-Nearest Neighbors</a></li>
</ul>
<p>Broadly speaking, the heap may be used everywhere where we need to keep track of the list of min or max elements that may be changed during the runtime.</p>
<h2 id="heapq" style="position:relative;"><a href="#heapq" aria-label="heapq permalink" class="anchor before"><svg class="anchor-icon" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>heapq</h2>
<p>Thankfully, it's not required to implement the heap yourself everytime you need it. Python provides a library called <a target="_blank" rel="noopener" href="https://docs.python.org/3/library/heapq.html">heapq</a> which is a set of functions that operates on the "heapified" array preserving the min-heap property.</p>
<p>The min-heap sort can be implemented this way:</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token keyword">import</span> heapq

heap <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">26</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">]</span>
heapq<span class="token punctuation">.</span>heapify<span class="token punctuation">(</span>heap<span class="token punctuation">)</span>

result <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
n <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>heap<span class="token punctuation">)</span>

<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>
    result<span class="token punctuation">.</span>append<span class="token punctuation">(</span>heapq<span class="token punctuation">.</span>heappop<span class="token punctuation">(</span>heap<span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre></div>
<h2 id="practice" style="position:relative;"><a href="#practice" aria-label="practice permalink" class="anchor before"><svg class="anchor-icon" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Practice</h2>
<ul>
<li><a target="_blank" rel="noopener" href="https://leetcode.com/problems/last-stone-weight/">[Leetcode] 1046. Last Stone Weight</a></li>
<li><a target="_blank" rel="noopener" href="https://leetcode.com/problems/single-threaded-cpu/">[Leetcode] 1834. Single-Threaded CPU</a></li>
<li><a target="_blank" rel="noopener" href="https://leetcode.com/problems/find-k-th-smallest-pair-distance/">[Leetcode] 719. Find K-th Smallest Pair Distance</a></li>
</ul>
<h2 id="summary" style="position:relative;"><a href="#summary" aria-label="summary permalink" class="anchor before"><svg class="anchor-icon" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Summary</h2>
<p>In this article, we have reviewed how to implement a priority queue, what properties it has and how it can be helpful.</p>
<p>If the heap concept was new for you, try to do a few problems from the practice section.</p>
<p>Finally, let me know in the comments what unusual applications of heaps you have seen in your practice.</p>
<h2 id="references" style="position:relative;"><a href="#references" aria-label="references permalink" class="anchor before"><svg class="anchor-icon" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>References</h2>
<ul>
<li><a target="_blank" rel="noopener" href="https://gist.github.com/roma-glushko/43678fcec904209adb276f33a56ce9de">Source code on GitHub</a></li>
<li><a target="_blank" rel="noopener" href="https://ocw.mit.edu/courses/electrical-engineering-and-computer-science/6-006-introduction-to-algorithms-fall-2011/lecture-videos/lecture-4-heaps-and-heap-sort/">MIT 6.006 - Heaps and Heap Sort</a></li>
<li><a target="_blank" rel="noopener" href="https://visualgo.net/en/heap">Heap Visualized</a></li>
</ul></div></div><div id="content-end"></div></article><div class="social-share-wrapper"><h3>Share Your Love</h3><button aria-label="Share Via Facebook" title="Share Via Facebook" class="react-share__ShareButton social-share-item facebook" style="background-color:transparent;border:none;padding:0;font:inherit;color:inherit;cursor:pointer"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="facebook" class="svg-inline--fa fa-facebook fa-w-16 " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M504 256C504 119 393 8 256 8S8 119 8 256c0 123.78 90.69 226.38 209.25 245V327.69h-63V256h63v-54.64c0-62.15 37-96.48 93.67-96.48 27.14 0 55.52 4.84 55.52 4.84v61h-31.28c-30.8 0-40.41 19.12-40.41 38.73V256h68.78l-11 71.69h-57.78V501C413.31 482.38 504 379.78 504 256z"></path></svg></button><button aria-label="Share Via Twitter" class="react-share__ShareButton social-share-item twitter" style="background-color:transparent;border:none;padding:0;font:inherit;color:inherit;cursor:pointer"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="twitter" class="svg-inline--fa fa-twitter fa-w-16 " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"></path></svg></button><button aria-label="Share Via LinkedIn" class="react-share__ShareButton social-share-item linkedin" style="background-color:transparent;border:none;padding:0;font:inherit;color:inherit;cursor:pointer"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="linkedin-in" class="svg-inline--fa fa-linkedin-in fa-w-14 " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M100.28 448H7.4V148.9h92.88zM53.79 108.1C24.09 108.1 0 83.5 0 53.8a53.79 53.79 0 0 1 107.58 0c0 29.7-24.1 54.3-53.79 54.3zM447.9 448h-92.68V302.4c0-34.7-.7-79.2-48.29-79.2-48.29 0-55.69 37.7-55.69 76.7V448h-92.78V148.9h89.08v40.8h1.3c12.4-23.5 42.69-48.3 87.88-48.3 94 0 111.28 61.9 111.28 142.3V448z"></path></svg></button><button aria-label="Share Via Reddit" class="react-share__ShareButton social-share-item reddit" style="background-color:transparent;border:none;padding:0;font:inherit;color:inherit;cursor:pointer"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="reddit" class="svg-inline--fa fa-reddit fa-w-16 " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M201.5 305.5c-13.8 0-24.9-11.1-24.9-24.6 0-13.8 11.1-24.9 24.9-24.9 13.6 0 24.6 11.1 24.6 24.9 0 13.6-11.1 24.6-24.6 24.6zM504 256c0 137-111 248-248 248S8 393 8 256 119 8 256 8s248 111 248 248zm-132.3-41.2c-9.4 0-17.7 3.9-23.8 10-22.4-15.5-52.6-25.5-86.1-26.6l17.4-78.3 55.4 12.5c0 13.6 11.1 24.6 24.6 24.6 13.8 0 24.9-11.3 24.9-24.9s-11.1-24.9-24.9-24.9c-9.7 0-18 5.8-22.1 13.8l-61.2-13.6c-3-.8-6.1 1.4-6.9 4.4l-19.1 86.4c-33.2 1.4-63.1 11.3-85.5 26.8-6.1-6.4-14.7-10.2-24.1-10.2-34.9 0-46.3 46.9-14.4 62.8-1.1 5-1.7 10.2-1.7 15.5 0 52.6 59.2 95.2 132 95.2 73.1 0 132.3-42.6 132.3-95.2 0-5.3-.6-10.8-1.9-15.8 31.3-16 19.8-62.5-14.9-62.5zM302.8 331c-18.2 18.2-76.1 17.9-93.6 0-2.2-2.2-6.1-2.2-8.3 0-2.5 2.5-2.5 6.4 0 8.6 22.8 22.8 87.3 22.8 110.2 0 2.5-2.2 2.5-6.1 0-8.6-2.2-2.2-6.1-2.2-8.3 0zm7.7-75c-13.6 0-24.6 11.1-24.6 24.9 0 13.6 11.1 24.6 24.6 24.6 13.8 0 24.9-11.1 24.9-24.6 0-13.8-11-24.9-24.9-24.9z"></path></svg></button><button aria-label="Add to Pocket" class="react-share__ShareButton social-share-item pocket" style="background-color:transparent;border:none;padding:0;font:inherit;color:inherit;cursor:pointer"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="get-pocket" class="svg-inline--fa fa-get-pocket fa-w-14 " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M407.6 64h-367C18.5 64 0 82.5 0 104.6v135.2C0 364.5 99.7 464 224.2 464c124 0 223.8-99.5 223.8-224.2V104.6c0-22.4-17.7-40.6-40.4-40.6zm-162 268.5c-12.4 11.8-31.4 11.1-42.4 0C89.5 223.6 88.3 227.4 88.3 209.3c0-16.9 13.8-30.7 30.7-30.7 17 0 16.1 3.8 105.2 89.3 90.6-86.9 88.6-89.3 105.5-89.3 16.9 0 30.7 13.8 30.7 30.7 0 17.8-2.9 15.7-114.8 123.2z"></path></svg></button></div></main><aside class="blogpost-sidebar"><div class="blog-navigation-wrapper"><h3>Read Other Posts</h3><nav class="blog-navigation"><div class="nav-links"><a rel="next" class="next-post" href="/blog/how-i-built-my-ml-workstation/">How I built my ML workstation 🔬<!-- --> →</a><a rel="prev" class="prev-post" href="/blog/design-lru-cache/">← <!-- -->Design LRU Cache</a><a class="all-posts" href="/blog/">All Posts</a></div></nav></div></aside><footer><div class="footer-wrapper"><div class="social"><ul class="social-list"><li class="social-item social-linkedin"><a rel="me" itemProp="url" href="https://www.linkedin.com/in/glushko-roman" title="Roman Glushko on LinkedIn" target="blank"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="linkedin-in" class="svg-inline--fa fa-linkedin-in fa-w-14 fa-2x " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M100.28 448H7.4V148.9h92.88zM53.79 108.1C24.09 108.1 0 83.5 0 53.8a53.79 53.79 0 0 1 107.58 0c0 29.7-24.1 54.3-53.79 54.3zM447.9 448h-92.68V302.4c0-34.7-.7-79.2-48.29-79.2-48.29 0-55.69 37.7-55.69 76.7V448h-92.78V148.9h89.08v40.8h1.3c12.4-23.5 42.69-48.3 87.88-48.3 94 0 111.28 61.9 111.28 142.3V448z"></path></svg><span>LinkedIn</span></a></li><li class="social-item social-github"><a rel="me" itemProp="url" href="https://github.com/roma-glushko" title="Roman Glushko on Github" target="blank"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="github-alt" class="svg-inline--fa fa-github-alt fa-w-15 fa-2x " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 480 512"><path fill="currentColor" d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"></path></svg><span>GitHub</span></a></li><li class="social-item social-email"><a itemProp="email" href="mailto:roman.glushko.m@gmail.com" title="Roman Glushko&#x27;s Email"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="envelope" class="svg-inline--fa fa-envelope fa-w-16 fa-2x " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M502.3 190.8c3.9-3.1 9.7-.2 9.7 4.7V400c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V195.6c0-5 5.7-7.8 9.7-4.7 22.4 17.4 52.1 39.5 154.1 113.6 21.1 15.4 56.7 47.8 92.2 47.6 35.7.3 72-32.8 92.3-47.6 102-74.1 131.6-96.3 154-113.7zM256 320c23.2.4 56.6-29.2 73.4-41.4 132.7-96.3 142.8-104.7 173.4-128.7 5.8-4.5 9.2-11.5 9.2-18.9v-19c0-26.5-21.5-48-48-48H48C21.5 64 0 85.5 0 112v19c0 7.4 3.4 14.3 9.2 18.9 30.6 23.9 40.7 32.4 173.4 128.7 16.8 12.2 50.2 41.8 73.4 41.4z"></path></svg><span>Email</span></a></li><li class="social-item social-kaggle"><a rel="me" itemProp="url" href="https://www.kaggle.com/glushko" title="Roman Glushko on Kaggle" target="blank"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="kaggle" class="svg-inline--fa fa-kaggle fa-w-10 fa-2x " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentColor" d="M304.2 501.5L158.4 320.3 298.2 185c2.6-2.7 1.7-10.5-5.3-10.5h-69.2c-3.5 0-7 1.8-10.5 5.3L80.9 313.5V7.5q0-7.5-7.5-7.5H21.5Q14 0 14 7.5v497q0 7.5 7.5 7.5h51.9q7.5 0 7.5-7.5v-109l30.8-29.3 110.5 140.6c3 3.5 6.5 5.3 10.5 5.3h66.9q5.25 0 6-3z"></path></svg><span>Kaggle</span></a></li><li class="social-item social-twitter"><a rel="me" itemProp="url" href="https://twitter.com/roma_glushko" title="Roman Glushko on Twitter" target="blank"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="twitter" class="svg-inline--fa fa-twitter fa-w-16 fa-2x " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"></path></svg><span>Twitter</span></a></li><li class="social-item social-patreon"><a rel="me" itemProp="url" href="https://www.patreon.com/roma_glushko" title="Support my content on Patreon" target="blank"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="patreon" class="svg-inline--fa fa-patreon fa-w-16 fa-2x " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M512 194.8c0 101.3-82.4 183.8-183.8 183.8-101.7 0-184.4-82.4-184.4-183.8 0-101.6 82.7-184.3 184.4-184.3C429.6 10.5 512 93.2 512 194.8zM0 501.5h90v-491H0v491z"></path></svg><span>Patreon</span></a></li></ul></div><div class="copyright">Roman Glushko © 1996 - <!-- -->2021<!-- --> <br/><a rel="license" href="https://creativecommons.org/licenses/by/4.0/" title="Content is published under CC BY 4.0 license">CC BY 4.0</a></div></div></footer><span></span><div class="mathjax"></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script>
  
  function gaOptout(){document.cookie=disableStr+'=true; expires=Thu, 31 Dec 2099 23:59:59 UTC;path=/',window[disableStr]=!0}var gaProperty='UA-148139633-1',disableStr='ga-disable-'+gaProperty;document.cookie.indexOf(disableStr+'=true')>-1&&(window[disableStr]=!0);
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'UA-148139633-1', 'auto', {"alwaysSendReferrer":true});
      ga('set', 'anonymizeIp', true);
      
      
      
      
      }</script><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/blog/heapify/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-de8843e408d337e1ffde.js"],"component---cache-caches-gatsby-plugin-offline-app-shell-js":["/component---cache-caches-gatsby-plugin-offline-app-shell-js-b8fe54a3d24900f783e9.js"],"component---src-pages-404-js":["/component---src-pages-404-js-25240c9772eb8843e093.js"],"component---src-pages-blog-js":["/component---src-pages-blog-js-cd273d639f0c9691a332.js"],"component---src-pages-cv-ecommerce-developer-js":["/component---src-pages-cv-ecommerce-developer-js-cf15df876b34bbb8fc55.js"],"component---src-pages-cv-machine-learning-engineer-js":["/component---src-pages-cv-machine-learning-engineer-js-1ae8099fd502a0f227f7.js"],"component---src-pages-index-js":["/component---src-pages-index-js-2a007b8adef1fde76add.js"],"component---src-pages-lab-js":["/component---src-pages-lab-js-d551f847ebf4bda5e3b4.js"],"component---src-pages-lab-rock-paper-scissors-index-js":["/component---src-pages-lab-rock-paper-scissors-index-js-d194efda58a3ec771c63.js"],"component---src-pages-nn-design-js":["/component---src-pages-nn-design-js-4400cf8669cd6162caac.js"],"component---src-pages-thoughts-js":["/component---src-pages-thoughts-js-d76b231dad86726de755.js"],"component---src-templates-blog-template-js":["/component---src-templates-blog-template-js-95e00e24c0c08926f00c.js"],"component---src-templates-thought-template-js":["/component---src-templates-thought-template-js-5d3117151848a0aee9c1.js"]};/*]]>*/</script><script src="/component---src-templates-blog-template-js-95e00e24c0c08926f00c.js" async=""></script><script src="/4622c33586ad0108e870f951288ae6aa3beabfab-9d3664eaca38d9dab227.js" async=""></script><script src="/418ffc66a997cc995fb5d56035c003ac177781e9-1af6fa4b36bef9e9a491.js" async=""></script><script src="/b1d143cac6741dab3b540359698892a994dd2b72-73811f87155839f25d7a.js" async=""></script><script src="/7fec078d47fb9647f833e2e6379c6e0182872dcf-593e4006fd0d611c716c.js" async=""></script><script src="/02e3c991cb460df38a850baf561b952fff7f05a7-120d26a5ba92bd694f64.js" async=""></script><script src="/styles-8636a280cbc61d53ad10.js" async=""></script><script src="/app-de8843e408d337e1ffde.js" async=""></script><script src="/framework-68e90182ffbbad46751e.js" async=""></script><script src="/webpack-runtime-22fa0e136c234d8b60a6.js" async=""></script></body></html>